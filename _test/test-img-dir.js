import fs from "fs";

const _TIME_TAG = "\tRun duration";
const _ALLOWLIST_DIRS = new Set([
	"Adventurers League",
	"AL",
	"ALseason8",
	"AOQ",
	"aotg",
	"Ar20",
	"Ar3",
	"Ar7",
	"ArcanumWorldsOdysseyoftheDragonlords",
	"Arka",
	"ASoS",
	"ATLAS",
	"BA",
	"BDPC",
	"BF",
	"BITC",
	"BoC",
	"CallfromtheDeep",
	"CCG",
	"CCodex",
	"CComp",
	"COK",
	"CombatWheelchair",
	"CotDDPRaS",
	"DAGIC",
	"DAPC",
	"DM05",
	"DM07",
	"DM09",
	"DM12",
	"DragonMagazine",
	"DragonPlus21Minion",
	"DrdCrcDrg",
	"DSV",
	"Dungeons&Doggies",
	"EdE",
	"EDemons",
	"EDevils",
	"ExEx",
	"ExpCCodex",
	"ExploringEberron",
	"FBlu",
	"FEF",
	"FFXIV5E",
	"FirearmsofTheRealm",
	"FleeMortals",
	"FMprev",
	"GaGR",
	"GDoF",
	"GfWMoM",
	"GHMG",
	"GHPG",
	"HGtMH",
	"HHH",
	"HiVE",
	"HoE",
	"JBoE",
	"JennysHomebrewStuff",
	"KftGV_CC",
	"KG",
	"KibblesTasty",
	"KPDM",
	"KPSC",
	"KTVSCO",
	"Lera",
	"LLAF",
	"LM",
	"LoRDToB",
	"MaM",
	"MartialPower",
	"MH",
	"mme2_v2",
	"mme_v2",
	"MModule",
	"MonsterManualExpanded",
	"MonsterManualExpanded2",
	"MonsterManualExpanded3",
	"MP",
	"MToMM",
	"MyconidRaces",
	"NerzugalsExtendedBestiary",
	"NMD",
	"PKB",
	"PlaneShiftKamigawa",
	"PlaneShiftTarkir",
	"RolledTold",
	"RotLDM",
	"ROTSSPGF",
	"SaF",
	"SecondGlance",
	"SJMAiS",
	"Skul",
	"SLCC",
	"SOD",
	"SoI",
	"Soulblade",
	"SSGRF",
	"TalDorei",
	"TBHA",
	"TCAH",
	"TDCSR",
	"TEB",
	"TGS1",
	"TheFluffyFolio",
	"ThirdTimesTheCharm",
	"ThoughtsPrayers",
	"TMR",
	"ToB",
	"ToB2",
	"ToB2-Lairs",
	"ToB3",
	"ToB3-Lairs",
	"ToMT",
	"TotBC",
	"TPK",
	"TPM",
	"TSGtTT",
	"TSSL",
	"TTAtPoG",
	"TTNSP",
	"TWC",
	"TWOC",
	"TWS SC",
	"Underworld",
	"VNPC",
	"W02DM",
	"W20RT",
	"W29_PB",
	"WCE",
	"WDMMC",
	"WJMAiS",
	"WL50",
	"WotCFarideh",
	"WWCT",
	"Wyl",
	"XLNEE",
	"YARV",
]);

async function main () {
	console.time(_TIME_TAG);

	if (!fs.existsSync("_img")) {
		console.timeEnd(_TIME_TAG);
		return;
	}

	const extraDirs = fs.readdirSync("_img")
		.filter(dir => !_ALLOWLIST_DIRS.has(dir));

	if (!extraDirs.length) {
		console.timeEnd(_TIME_TAG);
		return;
	}

	console.error(`Extra directories found in "_img":\n${extraDirs.map(d => `\t${d}`).join("\n")}`);
	console.timeEnd(_TIME_TAG);
	process.exit(1);
}

export default main();
